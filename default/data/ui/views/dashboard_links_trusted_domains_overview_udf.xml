<dashboard theme="dark" version="2">
    <label>Dashboards Links &amp; Trusted Domains Overview</label>
    <description/>
    <definition>
        <![CDATA[{
    "visualizations": {"viz_single_1": {"type": "splunk.singlevalue", "options": {"drilldown": "none", "majorColor": ">majorValue | matchValue(majorColorEditorConfig)", "backgroundColor": "transparent", "majorFontSize": 35 }, "dataSources": {"primary": "dashboard_csp.enforced"}, "showProgressBar": true, "title": "Content Security Policy Status", "context": {"convertedColorRange": [{"from": 100, "value": "#dc4e41"}, {"from": 70, "to": 100, "value": "#f1813f"}, {"from": 30, "to": 70, "value": "#f8be34"}, {"from": 0, "to": 30, "value": "#0877a6"}, {"to": 0, "value": "#53a051"} ], "majorColorEditorConfig": [{"match": "Enabled", "value": "#118832"}, {"match": "Disabled", "value": "#9E2520"} ] } }, "viz_table_1": {"type": "splunk.table", "options": {"drilldown": "none", "fontSize": "small", "showInternalFields": false, "backgroundColor": "transparent", "tableFormat": {"rowBackgroundColors": ">table | seriesByIndex(0) | pick(tableAltRowBackgroundColorsByBackgroundColor)", "headerBackgroundColor": "#31373e", "rowColors": ">rowBackgroundColors | maxContrast(tableRowColorMaxContrast)", "headerColor": ">headerBackgroundColor | maxContrast(tableRowColorMaxContrast)"}, "headerVisibility": "fixed", "count": 8 }, "dataSources": {"primary": "all_dashboards.allowed_domains"}, "showProgressBar": true, "title": "Trusted Domain List"}, "viz_table_2": {"type": "splunk.table", "options": {"drilldown": "none", "showInternalFields": false, "fontSize": "small", "backgroundColor": "transparent", "tableFormat": {"rowBackgroundColors": ">table | seriesByIndex(0) | pick(tableAltRowBackgroundColorsByBackgroundColor)", "headerBackgroundColor": "#31373e", "rowColors": ">rowBackgroundColors | maxContrast(tableRowColorMaxContrast)", "headerColor": ">headerBackgroundColor | maxContrast(tableRowColorMaxContrast)"}, "count": 12, "headerVisibility": "fixed"}, "dataSources": {"primary": "all_dashboards.blocked_domains"}, "showProgressBar": true, "title": "Blocked Domain List"}, "viz_table_3": {"type": "splunk.table", "options": {"drilldown": "none", "backgroundColor": "transparent", "tableFormat": {"rowBackgroundColors": ">table | seriesByIndex(0) | pick(tableAltRowBackgroundColorsByBackgroundColor)", "headerBackgroundColor": "#31373e", "rowColors": ">rowBackgroundColors | maxContrast(tableRowColorMaxContrast)", "headerColor": ">headerBackgroundColor | maxContrast(tableRowColorMaxContrast)"}, "showInternalFields": false, "fontSize": "small", "columnFormat": {"Is Allowed?": {"data": ">table | seriesByName(\"Is Allowed?\") | formatByType(Is_Allowed_ColumnFormatEditorConfig)", "rowColors": ">table | seriesByName('Is Allowed?') | pick(Is_Allowed_RowColorsEditorConfig)", "rowBackgroundColors": ">table | seriesByName('Is Allowed?') | matchValue(Is_Allowed_RowBackgroundColorsEditorConfig)"} }, "headerVisibility": "fixed", "count": 7 }, "dataSources": {"primary": "all_dashboards.all_links"}, "showProgressBar": true, "title": "All Dashboard Links", "context": {"Is_Allowed_ColumnFormatEditorConfig": {"string": {"unitPosition": "after"} }, "Is_Allowed_RowColorsEditorConfig": ["#ffffff"], "Is_Allowed_RowBackgroundColorsEditorConfig": [{"match": "No", "value": "#9E2520"}, {"match": "Yes", "value": "#118832"} ] } }, "viz_sy0yEt07": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.75, "rx": 10 } }, "viz_arFrznxH": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.75, "rx": 10 } }, "viz_mvSTP1Ws": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.75, "rx": 10 } }, "viz_zAb2NVFI": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.75, "rx": 10 } }, "viz_VMlPtwKG": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.75, "rx": 10 } }, "viz_UZ9lGk9M": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.7, "fillColor": "#181b1f", "strokeWidth": 0 } }, "viz_i6nwJ1w4": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.7, "fillColor": "#181b1f", "strokeWidth": 0 } }, "viz_klNnhLE6": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.7, "fillColor": "#181b1f", "strokeWidth": 0, "rx": 5 } }, "viz_yZ1qi6db": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.7, "fillColor": "#181b1f", "strokeWidth": 0 } }, "viz_aDjgT1AC": {"type": "splunk.singlevalue", "dataSources": {"primary": "ds_sorVEU6U"}, "title": "Blocked Link(s) Ratio", "options": {"majorFontSize": 32, "backgroundColor": "transparent"} }, "viz_U14tGPkF": {"type": "splunk.rectangle", "options": {"fillOpacity": 0.7, "fillColor": "#181b1f", "strokeWidth": 0, "rx": 5 } } }, "dataSources": {"ds_baseSearchAllDashboards": {"type": "ds.search", "options": {"query": "| rest splunk_server=local count=0 /servicesNS/-/-/data/ui/views f=eai:appName f=author f=title f=eai:data\n | rex field=eai:data max_match=0 \"(action|href|src|code)=\\\"(?<href>.*?)\\\"\"\n``` Remove anchors and relative links ```\n| eval href = mvfilter(match(href, \"(?i)^\\s*http[s]*\"))\n| where isnotnull(href) AND href != \"\"\n| mvexpand href\n``` Add domains in the configured allow list ```\n| eval [\n  | rest splunk_server=local /services/configs/conf-web-features/feature:dashboards_csp\n  | transpose\n  | search column=\"dashboards_trusted_domain.*\"\n  | eval value = \"\\s*\" . replace('row 1', \"\\*\", \".*\") . \".*\"\n  ``` Add default allowed domains ```\n  | append \n    [| inputlookup default_trusted_domains_lookup \n    | eval value = \"\\s*.*\" . domain . \".*\"\n    | fields value\n        ]\n  | stats values(value) as allowed\n  ``` Create a big REGEX of all allowed values ```\n  | eval allowed = \"(?i)(\" . mvjoin(allowed, \"|\") . \")\"\n  ``` Ensure we have a fallback for when nothing is configured ```\n  | appendpipe [stats count | where count=0 | eval allowed=\"^$\"]\n  | return allowed\n]\n| rex field=href max_match=0 \"(?i)^\\s*http[s]*\\:\\/\\/(?<domain>.*?)(\\/|$)\"\n| eval isAllowed = if(match(href, allowed), \"Yes\", \"No\")\n", "queryParameters": {"earliest": "-1m@m", "latest": "now"} }, "name": "ds_baseSearchAllDashboards"}, "dashboard_csp.enforced": {"type": "ds.search", "options": {"query": "| rest splunk_server=local /services/properties/web-features/feature:dashboards_csp/enforce_dashboards_csp\n| eval value = if(value==\"true\", \"Enabled\", \"Disabled\")\n| table value"}, "name": "dashboard_csp.enforced"}, "all_dashboards.allowed_domains": {"type": "ds.search", "options": {"query": "| rest splunk_server=local count=0 /services/configs/conf-web-features/feature:dashboards_csp\n| transpose\n| search column=\"dashboards_trusted_domain.*\"\n| eval column = replace(column, \"^dashboards_trusted_domain\\.\", \"\")\n| rename column as Name, \"row 1\" as Value\n| append \n [| inputlookup default_trusted_domains_lookup \n| eval Name = \"Default Allowed Domains\" \n| rename domain as Value]\n", "queryParameters": {"earliest": 0, "latest": ""} }, "name": "all_dashboards.allowed_domains"}, "all_dashboards.blocked_domains": {"type": "ds.chain", "options": {"query": "| search isAllowed=\"No\"\n| stats values(domain) as Domains\n| mvexpand Domains\n| sort Domains", "extend": "ds_baseSearchAllDashboards"}, "name": "all_dashboards.blocked_domains"}, "all_dashboards.all_links": {"type": "ds.chain", "options": {"query": "| stats dc(href) as links_count values(domain) as Domains values(href) as Links by author eai:appName title isAllowed\n| where links_count >0\n| sort eai:appName, title, isAllowed\n| rename author as Author, eai:appName as App, title as Dashboard, links_count as \"Links #\", isAllowed as \"Is Allowed?\"\n| $tokShowLinks$", "extend": "ds_baseSearchAllDashboards"}, "name": "all_dashboards.all_links"}, "ds_sorVEU6U": {"type": "ds.chain", "options": {"extend": "ds_baseSearchAllDashboards", "query": "| stats count as Total count(eval(isAllowed=\"No\")) as Blocked\n| eval Ratio = Round(Blocked/Total * 100, 2) . \"% (\" . Blocked . \"/\" . Total . \")\"\n| table Ratio"}, "name": "all_dashboards.blocked_ratio"} }, "defaults": {"dataSources": {"ds.search": {"options": {"queryParameters": {} } } } }, "inputs": {"input_QMidvo7P": {"options": {"items": [{"label": "Yes", "value": "noop"}, {"label": "No", "value": "fields - Links"} ], "defaultValue": "fields - Links", "token": "tokShowLinks"}, "title": "Show Links?", "type": "input.dropdown"} }, "layout": {"type": "absolute", "options": {"submitButton": false, "display": "auto-scale", "height": 750, "backgroundImage": {"sizeType": "cover", "x": 0, "y": 0, "src": "splunk-enterprise-kvstore://647a1d928a02e97649277726"} }, "structure": [{"item": "viz_VMlPtwKG", "type": "block", "position": {"x": 5, "y": 410, "w": 1195, "h": 340 } }, {"item": "viz_sy0yEt07", "type": "block", "position": {"x": 5, "y": 20, "w": 280, "h": 180 } }, {"item": "viz_arFrznxH", "type": "block", "position": {"x": 290, "y": 20, "w": 620, "h": 380 } }, {"item": "viz_mvSTP1Ws", "type": "block", "position": {"x": 915, "y": 20, "w": 285, "h": 380 } }, {"item": "viz_zAb2NVFI", "type": "block", "position": {"x": 5, "y": 205, "w": 280, "h": 195 } }, {"item": "viz_UZ9lGk9M", "type": "block", "position": {"x": 300, "y": 90, "w": 596, "h": 300 } }, {"item": "viz_i6nwJ1w4", "type": "block", "position": {"x": 930, "y": 90, "w": 260, "h": 300 } }, {"item": "viz_klNnhLE6", "type": "block", "position": {"x": 20, "y": 60, "w": 250, "h": 120 } }, {"item": "viz_single_1", "type": "block", "position": {"x": 10, "y": 20, "w": 270, "h": 170 } }, {"item": "viz_table_1", "type": "block", "position": {"x": 290, "y": 20, "w": 615, "h": 380 } }, {"item": "viz_table_2", "type": "block", "position": {"x": 920, "y": 20, "w": 280, "h": 270 } }, {"item": "viz_yZ1qi6db", "type": "block", "position": {"x": 20, "y": 490, "w": 1165, "h": 250 } }, {"item": "viz_table_3", "type": "block", "position": {"x": 5, "y": 420, "w": 1190, "h": 330 } }, {"item": "viz_U14tGPkF", "type": "block", "position": {"x": 20, "y": 260, "w": 250, "h": 120 } }, {"item": "viz_aDjgT1AC", "type": "block", "position": {"x": 10, "y": 220, "w": 270, "h": 170 } } ], "globalInputs": ["input_QMidvo7P"] }, "description": "Overview of links used in Dashboards and the Trusted Domains configuration.", "title": "Dashboards Links & Trusted Domains Overview"}]]>
    </definition>
    <assets>
        <![CDATA[{}]]>
    </assets>
</dashboard>